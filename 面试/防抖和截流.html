<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style>
        .demo {
            width: 200px;
            height: 5000px;
            background: green;
        }

        .demo1 {
            width: 200px;
            height: 4000px;
        }

        .demo2 {
            width: 200px;
            height: 1000px;
        }
    </style>
</head>

<body>
    <div class="demo" id="demo">
        <div class="demo1">
            2121
        </div>
        <div class="demo2">
            2212
            <img id="img" src="" alt="">
        </div>
    </div>
    <script>
        //防抖函数 触发之后延迟执行。 在范围时间内再次触发则重新计算时间
        function dou(fun, time, immediate, promise) {
            var task = null
            var flag = true
            if (immediate) {
                return function () {
                    fun.call(this, ...arguments)
                    flag = false
                    task = setTimeout(() => {
                        fun.call(this)
                    }, time)
                }
            }
            return function () {
                if (task) {
                    clearTimeout(task)
                }
                if (promise) {
                    tisk = promise().then()
                }
                else {
                    task = setTimeout(() => {
                        fun.call(this)
                    }, time)
                }
            }
        }
        var callback = function () {
            var scrollTop = document.documentElement.scrollTop // || window.pageYOffset || document.body.scrollTop;
            var innerHeight = window.innerHeight
            var offsetTop = document.getElementsByClassName('demo2')[0].offsetTop

            console.log(scrollTop, 'scrollTop')
            console.log(innerHeight, 'innerHeight')
            console.log(offsetTop, 'offsetTop')
            if (scrollTop + innerHeight > offsetTop) {
                var img = new Image()
                img.src = './1.png'
                img.onload = function () {
                    document.getElementById('img').setAttribute('src', img.src)
                }
            }

        }
        // document.getElementById('demo').addEventListener('mousewheel', dou(callback, 500))
        // window.onresize = dou(callback, 500)

        // setInterval(dou(callback, 500), 100);
        // dou(callback, 500)()
        // dou(callback, 500)()

        // 数据截流  触发多次执行一次
        // 防止重复提交表单
        // 远程搜索

        function jieliu(callback, time) {
            let lastTime = null
            return function () {
                let newtime = new Date().getTime() // 记下当前时间
                if (newtime - lastTime > time || !lastTime) {
                    callback.call(this)
                    lastTime = newtime
                }
            }
        }
        document.getElementById('demo').addEventListener('mousewheel', jieliu(callback, 1000))
        srollTop + clientheight = scrollHeight
    </script>
</body>

</html>